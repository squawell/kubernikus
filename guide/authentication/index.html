<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Authentication - Kubernikus</title>
    <meta name="generator" content="Hugo 0.30.2" />

    
    <link rel="canonical" href="/kubernikus/guide/authentication/">
    

    <meta property="og:url" content="/kubernikus/guide/authentication/">
    <meta property="og:title" content="Kubernikus">
    <meta property="og:image" content="/kubernikus/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Kubernikus">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="/kubernikus/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="/kubernikus/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('/kubernikus/fonts/icon.eot');
        src: url('/kubernikus/fonts/icon.eot')
               format('embedded-opentype'),
             url('/kubernikus/fonts/icon.woff')
               format('woff'),
             url('/kubernikus/fonts/icon.ttf')
               format('truetype'),
             url('/kubernikus/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="/kubernikus/stylesheets/application.css">
    <link rel="stylesheet" href="/kubernikus/stylesheets/temporary.css">
    <link rel="stylesheet" href="/kubernikus/stylesheets/palettes.css">
    <link rel="stylesheet" href="/kubernikus/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="/kubernikus/stylesheets/hacks.css">
    
    
    <script src="/kubernikus/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-blue palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Authentication
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/sapcc/kubernikus" title="@sapcc/kubernikus on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/sapcc/kubernikus" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="/kubernikus/images/logo.png">
        </div>
      
      <div class="name">
        <strong>Kubernikus </strong>
        
          <br>
          sapcc/kubernikus
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/sapcc/kubernikus/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/sapcc/kubernikus/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        


<ul>
  
  <li>
    <a  href="/kubernikus/development/controllers/">Development</a>

    
  </li>
  
  <li>
    <a  href="/kubernikus/guide/getting_started/">Guide</a>

    
    <ul class="anchor">
      
      <li class="anchor"><a  href="/kubernikus/guide/getting_started/">Getting Started</a></li>
      
      <li class="anchor"><a class="current" href="/kubernikus/guide/authentication/">Authentication</a></li>
      
      <li class="anchor"><a  href="/kubernikus/guide/best_practices/">Best Practices</a></li>
      
      <li class="anchor"><a  href="/kubernikus/guide/common_addons/">Common Addons</a></li>
      
    </ul>
    
  </li>
  
  <li>
    <a  href="/kubernikus/operations/controlplane/">Operations</a>

    
  </li>
  
</ul>


        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Authentication </h1>

			

<h2 id="intro">Intro</h2>

<p>In Kubernetes regular end-users are assumed to be managed by an outside,
independent service. In this regard, Kubernetes does not have objects which
represent normal user accounts. Regular users cannot be added to a cluster
through an API call.</p>

<p>API requests are tied to either a normal user or a service account, or are
treated as anonymous requests. This means every process inside or outside the
cluster, from a human user typing kubectl on a workstation, to kubelets on
nodes, to members of the control plane, must authenticate when making requests
to the API server, or be treated as an anonymous user.</p>

<h3 id="user-management">User-Management</h3>

<p>For Kubernikus clusters the user management is handled by OpenStack&rsquo;s Identity
Service (Keystone). Only users that have been given a <code>os:kubernikus_admin</code> or
<code>os:kubernikus_member</code> roles by an Keystone administrator are allowed to interact
with the service or clusters.</p>

<h3 id="authentication">Authentication</h3>

<p>The authentication against Kubernikus clusters is based on x509 certificates.
Encoded into the certificate&rsquo;s <code>Common Name</code> field is the user name. The
certificate&rsquo;s <code>organization</code> fields indicate the user&rsquo;s OpenStack role
assignments.</p>

<p>This effectively maps OpenStack roles to Kubernetes groups.</p>

<p>These certificates are generated. They can be retrieved via UI or API. In order
to allow for revocation of authorization the certificates are short lived. They
automatically expire after 24h. Therefore they need to be periodically
refreshed.</p>

<h3 id="authorizations">Authorizations</h3>

<p>Using the <code>user</code> and <code>groups</code> provided by the authentication mechanism it is
then possible to use <a href="https://kubernetes.io/docs/admin/authorization/rbac/">Kubernetes
RBAC</a> to define
authorizations within Kubernetes.</p>

<p>By distinguishing between users as well as <code>kubernikus_admin</code> and <code>kubernikus_member</code>
roles/groups it is possible to assign different Kubernetes roles to groups or
individual users.</p>

<h2 id="manage-roles-in-openstack">Manage Roles in OpenStack</h2>

<p>Users with <code>Keystone Administrator</code> role are allowed to change user role
assignments in a project.</p>

<p><img src="https://raw.githubusercontent.com/sapcc/kubernikus/master/assets/images/docs/containers/kubernetes/userroleassignments.png" alt="User Role
Assignments" /></p>

<p>To add additional users to a cluster they need to be
given either <code>Kubernetes Admin</code> or <code>Kubernetes Member</code> roles.</p>

<p><img src="https://raw.githubusercontent.com/sapcc/kubernikus/master/assets/images/docs/containers/kubernetes/roleassignment.png" alt="Role Assignments" /></p>

<h2 id="authenticating-with-kubernetes">Authenticating with Kubernetes</h2>

<p>Kubernetes is usually remote controlled with the <code>kubectl</code> command line tool.
It is configured through a config file <code>.kubeconfig</code>. For installation
instructions please see the <a href="https://kubernetes.io/docs/user-guide/kubectl-overview/">official
documentation</a>.</p>

<h3 id="manual-download">Manual Download</h3>

<p>A preconfigured <code>.kubeconfig</code> file can be downloaded from the UI or fetched via
API:</p>

<p><img src="https://raw.githubusercontent.com/sapcc/kubernikus/master/assets/images/docs/containers/kubernetes/credentials.png" alt="Download Credentials" /></p>

<h3 id="automatic-refresh">Automatic Refresh</h3>

<p>Since the certificates expire daily it becomes quite tedious to download new
<code>.kubeconfig</code> files every day. To help with this workflow there is a CLI tool
<code>kubernikusctl</code> for remote controlling Kubernikus clusters.</p>

<p>The tool is available precompiled for Linux, MacOS and Windows. The latest
version can be downloaded from <a href="https://github.com/sapcc/kubernikus/releases/latest">Github</a>.</p>

<p>Setting up an automatic refresh of the <code>.kubeconfig</code> file is a 2-step process:</p>

<ol>
<li><code>kubernikusctl auth init --many --auth --options</code></li>
<li><code>kubernikusctl auth refresh</code></li>
</ol>

<p>The initialisation only needs to be done once. Afterwards a <code>refresh</code> is
possible without repeating all authentication details.</p>

<p><img src="https://raw.githubusercontent.com/sapcc/kubernikus/master/assets/images/docs/containers/kubernetes/setup.png" alt="Setup" /></p>

<p>The UI provides the full <code>kubernikusctl auth init</code> initialisation command for
convenience.</p>

<h3 id="default-permissions">Default Permissions</h3>

<p>By default any user with the <code>Kubernetes Admin</code> OpenStack role is assigned the
<code>cluster-admin</code> Kubernetes role. This is a super-admin that is allowed
everything.</p>

<p>Otherwise, the default Kubernetes RBAC policies grant very restrictive
permissions. Users with the <code>Kubernetes Member</code> OpenStack role need to be
assigned further permissions.</p>

<p>For example, to grant cluster-wide, full access:</p>

<pre><code>kubectl create clusterrolebinding cluster-admin
  --clusterrole=cluster-admin
  --group=kubernetes_member
</code></pre>

<p>~&gt; Note: This allows to perform any action against the API, including viewing secrets and modifying permissions. It is not a recommended policy.</p>


			<aside class="copyright" role="note">
				
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="/kubernikus/features/" title="">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="/kubernikus/guide/best_practices/" title="Best Practices">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Best Practices
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '\/kubernikus';
      var repo_id  = 'sapcc\/kubernikus';
    
    </script>

    <script src="/kubernikus/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

